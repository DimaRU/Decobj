      PROGRAM TSTOBJ
C
C РАСПЕЧАТКА СТРУКТУРЫ .OBJ - МОДУЛЯ
C
      BYTE	OBJLIN(400),IFILN(20),OFILN(20),BYTS(2)
      INTEGER	LENGTH,POINTR,INUM,WRD,OFFSET
      EQUIVALENCE (WRD,BYTS)
      COMMON	/GLB/ LENGTH,POINTR,OBJLIN,INUM,INUM1
C
      INTEGER	TYPE,GSDTYP,RLDTYP
C
      DEFINE FILE 1 (500,256,U,INUM)
C
      TYPE 1010
1010  FORMAT(' ВХОДНОЙ ФАЙЛ?',/)
      CALL ASSIGN(1,0,-1,'RO')
      TYPE 1011
1011  FORMAT(' ВЫХОДНОЙ ФАЙЛ?',/)
      CLOSE(UNIT=7)
      CALL ASSIGN(7,0,-1,'NEW')
C
      FIND (1'1)
      INUM1=1
C НАЧАЛО ОБРАБОТКИ
      TYPE=0
1     CALL GETLIN
      TYPE=OBJLIN(1)
      POINTR=3
C	    1  2  3  4	5  6
      GOTO (11,12,13,15,16,3),TYPE
3     WRITE(7,*) '------ ENDMOD --------'
      STOP		! КОНЕЦ МОДУЛЯ
C
C ОБРАБОТКА GSD - БЛОКА
C
 11   WRITE(7,1002) LENGTH-4
1002  FORMAT(' GSD, LENGTH=',O3)
       GOTO 1
C
C ОБРАБОТКА ISD - БЛОКА
C
 16   WRITE(7,1009) LENGTH-4
1009  FORMAT(' ISD, LENGTH=',O3)
       GOTO 1
 9    STOP 'УКАЗАТЕЛЬ ВЫШЕЛ ЗА ГРАНИЦУ!'
C
C ENDGSD
C
 12   WRITE(7,*) 'ENDGSD'
      GOTO 1
C
C TXT - БЛОК
C
 13   BYTS(1)=OBJLIN(3)
      BYTS(2)=OBJLIN(4)
      WRITE(7,1000) WRD,LENGTH-4
1000  FORMAT(' TXT, LOADAD=',O6,' LENGTH=',O3)
      GOTO 1
C
C ОБРАБОТКА RLD - БЛОКА
C
 15   WRITE(7,1015) LENGTH
1015  FORMAT(' RLD, LENGTH=',O3)
 14   IF (OBJLIN(POINTR).LT.0) WRITE(7,*) 'BYTE RELOCATION'
      RLDTYP=OBJLIN(POINTR)
      OFFSET=OBJLIN(POINTR+1)
      RLDTYP=RLDTYP.AND."000177 	! ОСТАВИТЬ БИТЫ ТИПА
       WRITE(7,1001) RLDTYP,OFFSET
1001  FORMAT(' RLD TYPE =',O2,' OFFSET=',O3)
      GOTO (34,26,34,26,210,210,310,34,32,36,14,36,310,310,17,34),RLDTYP
C	    1  2  3  4	5   6	7   10 11 12 13 14  15	16 17 20
C
 32   POINTR=POINTR+2
      GOTO 141
 34   POINTR=POINTR+4
      GOTO 141
 36   POINTR=POINTR+6
      GOTO 141
 310  POINTR=POINTR+8
 141  IF (POINTR-LENGTH-1) 14,1,9
C
 26   GOTO 36
 210  GOTO 310
C
C  COMPLEX RELOCATION
C
 17   WRITE(7,*) '***** COMPLEX RELOCATION'
      POINTR=POINTR+2
 171  WRITE (7,1003) OBJLIN(POINTR)
1003  FORMAT(' OPERATION TYPE=',O2)
      IF (OBJLIN(POINTR).GE."12) GOTO 172
      POINTR=POINTR+1
      GOTO 171
 172  IF (OBJLIN(POINTR).GE."16) GOTO 173
      POINTR=POINTR+1
      GOTO 141		! КОНЕЦ COMPLEX
 173  IF (OBJLIN(POINTR).LT."21) GOTO 174
      POINTR=POINTR+1
      GOTO 171
 174  POINTR=POINTR+"23-OBJLIN(POINTR)
      GOTO 171
C
C
C
      END
      SUBROUTINE GETLIN
      BYTE	OBJLIN(400)
      INTEGER	LENGTH,POINTR
      COMMON	/GLB/ LENGTH,POINTR,OBJLIN
C
      INTEGER LEN1
      BYTE LEN2(2),BUFFER
      EQUIVALENCE (LEN1,LEN2)
C
2     CALL GETBYT(BUFFER)		! 1
      IF(BUFFER.NE.1) GOTO 2
      CALL GETBYT(BUFFER)		! 0
      IF(BUFFER.NE.0) GOTO 2
      CALL GETBYT(LEN2(1))
      CALL GETBYT(LEN2(2))
      LENGTH=LEN1-4
      DO 1 I=1,LENGTH
 1    CALL GETBYT(OBJLIN(I))
      CALL GETBYT(BUFFER)		! КОТРОЛЬНАЯ СУММА
      RETURN
      END
      SUBROUTINE GETBYT(BYT)
      BYTE	OBJLIN(400)
      INTEGER	LENGTH,POINTR
      COMMON	/GLB/ LENGTH,POINTR,OBJLIN,INUM,INUM1
      INTEGER	BUFWRD(256),IPNT,INUM,INUM1
      BYTE	BYT,BUFBYT(512)
      EQUIVALENCE (BUFWRD,BUFBYT)
      DATA	IPNT /513/
C
      IF (IPNT.LE.512) GOTO 1
      IPNT=1
      READ(1'INUM) BUFWRD
1     BYT=BUFBYT(IPNT)
      IPNT=IPNT+1
      RETURN
      END
